<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Post with Comments</title>
    <link rel="stylesheet" href="ViewPost.css">
</head>

<body>
    <nav class="nav">
        <ul class="navLinks">
            <li><a href="MainPage.html">Home</a></li>
            <li><a href="CreatePost.html">Posts</a></li>
            <li><a href="AccountPage.html">Profile</a></li>
        </ul>
        <form class="searchForm" action="searchResultsPage.html" method="GET">
            <label>
                <textarea class="searchInput" name="search" placeholder="Search..."></textarea>
            </label>
            <button type="submit" class="searchButton">Go</button>
        </form>
    </nav>

    <div class="container">
        <div class="left-column">
            <h2>Similar Posts</h2>

            <a href="#">Similar Post 1</a><br>
            <a href="#">Similar Post 2</a><br>
            <a href="#">Similar Post 3</a>
        </div>

        <div class="main-container">
            <article class="post-container">
                <h1 id="post-title">Post Title Here</h1>
                <p>Posted by <a id="post-author" href="#">Username</a> on <time id="post-date" datetime="2022-08-24">August 24, 2022</time></p>
                <img id="post-image" src="postImageURL.jpg" alt="Post Image" class="post-image">
                <p class="post-content" id="post-content">Post content goes here...</p>
            </article>
            </article>

            <section class="comments-section">
                <h2>Comments</h2>
                <!-- Container for dynamically inserting comments -->
                <div id="comments-container"></div>
                <!-- Form remains the same -->
                <form class="comment-form">
                    <textarea placeholder="Write a comment..." class="comment-input"></textarea>
                    <button type="submit" class="submit-comment">Submit Comment</button>
                </form>
                
            </section>
        </div>
        <script> document.addEventListener('DOMContentLoaded', () => {
            
            fetchCommentsData();
        });
        
        function fetchCommentsData() {
            fetch('/fetchComments.php', { 
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'lastCommentId=0' //  send the last comment ID dynamically
            })
            .then(response => response.json())
            .then(data => {
                const commentsContainer = document.getElementById('comments-container');
                commentsContainer.innerHTML = ''; // Clear existing comments
                data.comments.forEach(comment => {
                    const commentElement = document.createElement('div');
                    commentElement.classList.add('comment');
                    commentElement.innerHTML = `
                        <p class="comment-author">Comment by <a href="#">${comment.user}</a> on <time datetime="${comment.timestamp}">${new Date(comment.timestamp).toLocaleString()}</time></p>
                        <p class="comment-content">${comment.text}</p>
                    `;
                    commentsContainer.appendChild(commentElement);
                });
            })
            .catch(error => console.error('Error fetching comments data:', error));
        }
        
        </script>
        <div class="right-column">
            <h2>Ad Space</h2>

            <p>Advertise Here!</p>
        </div>
    </div>
</body>

</html>